(function(){var n=$.fn.dataTable,q,h=function(a,b,d,c,f,e){var g=this;void 0===e&&(e=null);if(!n||!n.versionCheck||!n.versionCheck("1.10.0"))throw Error("SearchPane requires DataTables 1.10 or newer");if(!n.select)throw Error("SearchPane requires Select");a=new n.Api(a);this.classes=$.extend(!0,{},h.classes);this.c=$.extend(!0,{},h.defaults,b);this.customPaneSettings=e;this.s={cascadeRegen:!1,clearing:!1,colOpts:[],deselect:!1,displayed:!1,dt:a,dtPane:void 0,filteringActive:!1,index:d,indexes:[],
lastSelect:!1,listenerActive:!1,redraw:!1,rowData:{arrayFilter:[],arrayOriginal:[],arrayTotals:[],bins:{},binsOriginal:{},binsTotal:{},filterMap:new Map},searchFunction:void 0,selectPresent:!1,serverSelect:[],serverSelecting:!1,tableLength:null,updating:!1};b=a.columns().eq(0).toArray().length;this.colExists=this.s.index<b;this.c.layout=c;b=parseInt(c.split("-")[1],10);this.dom={buttonGroup:$("<div/>").addClass(this.classes.buttonGroup),clear:$('<button type="button">&#215;</button>').addClass(this.classes.dull).addClass(this.classes.paneButton).addClass(this.classes.clearButton),
container:$("<div/>").addClass(this.classes.container).addClass(this.classes.layout+(7>b?c:c.split("-")[0]+"-6")),countButton:$('<button type="button"></button>').addClass(this.classes.paneButton).addClass(this.classes.countButton),dtP:$("<table><thead><tr><th>"+(this.colExists?$(a.column(this.colExists?this.s.index:0).header()).text():this.customPaneSettings.header||"Custom Pane")+"</th><th/></tr></thead></table>"),lower:$("<div/>").addClass(this.classes.subRow2).addClass(this.classes.narrowButton),
nameButton:$('<button type="button"></button>').addClass(this.classes.paneButton).addClass(this.classes.nameButton),searchBox:$("<input/>").addClass(this.classes.paneInputButton).addClass(this.classes.search),searchButton:$('<button type = "button" class="'+this.classes.searchIcon+'"></button>').addClass(this.classes.paneButton),searchCont:$("<div/>").addClass(this.classes.searchCont),searchLabelCont:$("<div/>").addClass(this.classes.searchLabelCont),topRow:$("<div/>").addClass(this.classes.topRow),
upper:$("<div/>").addClass(this.classes.subRow1).addClass(this.classes.narrowSearch)};this.s.displayed=!1;a=this.s.dt;this.selections=[];this.s.colOpts=this.colExists?this._getOptions():this._getBonusOptions();var k=this.s.colOpts,c=$('<button type="button">X</button>').addClass(this.classes.paneButton);$(c).text(a.i18n("searchPanes.clearPane","X"));this.dom.container.addClass(k.className);this.dom.container.addClass(null!==this.customPaneSettings&&void 0!==this.customPaneSettings.className?this.customPaneSettings.className:
"");$(f).append(this.dom.container);var u=a.table(0).node();this.s.searchFunction=function(a,b,d){if(0===g.selections.length||a.nTable!==u)return!0;a="";g.colExists&&(a=b[g.s.index],"filter"!==k.orthogonal.filter&&(a=g.s.rowData.filterMap.get(d),a instanceof $.fn.dataTable.Api&&(a=a.toArray())));return g._search(a,d)};$.fn.dataTable.ext.search.push(this.s.searchFunction);if(this.c.clear)$(c).on("click",function(){g.dom.container.find(g.classes.search).each(function(){$(this).val("");$(this).trigger("input")});
g.clearPane()});a.on("draw.dtsp",function(){g._adjustTopRow()});$(window).on("resize.dtsp",n.util.throttle(function(){g._adjustTopRow()}));a.on("column-reorder.dtsp",function(a,b,d){g.s.index=d.mapping[g.s.index]});return this};h.prototype.clearData=function(){this.s.rowData={arrayFilter:[],arrayOriginal:[],arrayTotals:[],bins:{},binsOriginal:{},binsTotal:{},filterMap:new Map}};h.prototype.clearPane=function(){this.s.dtPane.rows({selected:!0}).deselect();this.updateTable();return this};h.prototype.destroy=
function(){$(this.s.dtPane).off(".dtsp");$(this.s.dt).off(".dtsp");$(this.dom.nameButton).off(".dtsp");$(this.dom.countButton).off(".dtsp");$(this.dom.clear).off(".dtsp");$(this.dom.searchButton).off(".dtsp");$(this.dom.container).remove();for(var a=$.fn.dataTable.ext.search.indexOf(this.s.searchFunction);-1!==a;)$.fn.dataTable.ext.search.splice(a,1),a=$.fn.dataTable.ext.search.indexOf(this.s.searchFunction);void 0!==this.s.dtPane&&this.s.dtPane.destroy()};h.prototype.getPaneCount=function(){return void 0!==
this.s.dtPane?this.s.dtPane.rows({selected:!0}).data().toArray().length:0};h.prototype.rebuildPane=function(a,b){void 0===a&&(a=null);void 0===b&&(b=null);this.clearData();void 0!==this.s.dtPane&&this.s.dtPane.clear().destroy();this.dom.container.removeClass(this.classes.hidden);this.s.displayed=!1;this._buildPane(a,b);return this};h.prototype.removePane=function(){this.s.displayed=!1;$(this.dom.container).hide()};h.prototype.setCascadeRegen=function(a){this.s.cascadeRegen=a};h.prototype.setClear=
function(a){this.s.clearing=a};h.prototype.updatePane=function(a){void 0===a&&(a=!1);this.s.updating=!0;this._updateCommon(a);this.s.updating=!1};h.prototype.updateTable=function(){this.selections=this.s.dtPane.rows({selected:!0}).data().toArray();this._searchExtras();(this.c.cascadePanes||this.c.viewTotal)&&this.updatePane()};h.prototype._addOption=function(a,b,d,c,f,e){if(Array.isArray(a)||a instanceof n.Api)if(a instanceof n.Api&&(a=a.toArray(),b=b.toArray()),a.length===b.length)for(var g=0;g<
a.length;g++)e[a[g]]?e[a[g]]++:(e[a[g]]=1,f.push({display:b[g],filter:a[g],sort:d,type:c}));else throw Error("display and filter not the same length");else"string"===typeof this.s.colOpts.orthogonal?e[a]?e[a]++:(e[a]=1,f.push({display:b,filter:a,sort:d,type:c})):f.push({display:b,filter:a,sort:d,type:c})};h.prototype._addRow=function(a,b,d,c,f,e){for(var g,k=0,h=this.s.indexes;k<h.length;k++){var l=h[k];l.filter===b&&(g=l.index)}void 0===g&&(g=this.s.indexes.length,this.s.indexes.push({filter:b,index:g}));
return this.s.dtPane.row.add({display:""!==a?a:this.c.emptyMessage,filter:b,index:g,shown:d,sort:""!==f?f:this.c.emptyMessage,total:c,type:e})};h.prototype._adjustTopRow=function(){var a=this.dom.container.find("."+this.classes.subRowsContainer),b=this.dom.container.find(".dtsp-subRow1"),d=this.dom.container.find(".dtsp-subRow2"),c=this.dom.container.find("."+this.classes.topRow);(252>$(a[0]).width()||252>$(c[0]).width())&&0!==$(a[0]).width()?($(a[0]).addClass(this.classes.narrow),$(b[0]).addClass(this.classes.narrowSub).removeClass(this.classes.narrowSearch),
$(d[0]).addClass(this.classes.narrowSub).removeClass(this.classes.narrowButton)):($(a[0]).removeClass(this.classes.narrow),$(b[0]).removeClass(this.classes.narrowSub).addClass(this.classes.narrowSearch),$(d[0]).removeClass(this.classes.narrowSub).addClass(this.classes.narrowButton))};h.prototype._buildPane=function(a,b){var d=this;void 0===a&&(a=null);void 0===b&&(b=null);this.selections=[];var c=this.s.dt,f=c.column(this.colExists?this.s.index:0),e=this.s.colOpts,g=this.s.rowData,k=c.i18n("searchPanes.count",
"{total}"),h=c.i18n("searchPanes.countFiltered","{shown} ({total})"),l=c.state.loaded();if(this.colExists){var m=-1;if(l&&l.searchPanes&&l.searchPanes.panes)for(var i=0;i<l.searchPanes.panes.length;i++)if(l.searchPanes.panes[i].id===this.s.index){m=i;break}if((!1===e.show||void 0!==e.show&&!0!==e.show)&&-1===m)return this.dom.container.addClass(this.classes.hidden),this.s.displayed=!1;if(!0===e.show||-1!==m)this.s.displayed=!0;if(this.s.dt.page.info().serverSide){if(null!==a){if(null===this.s.tableLength||
c.rows()[0].length>this.s.tableLength)this.s.tableLength=c.rows()[0].length;m=c.column(this.s.index).dataSrc();i=0;for(m=a[m];i<m.length;i++){var j=m[i];this.s.rowData.arrayFilter.push({display:j.label,filter:j.value,sort:j.label,type:j.label});this.s.rowData.bins[j.value]=j.count;this.s.rowData.binsTotal[j.value]=j.total}i=Object.keys(g.binsTotal).length;m=this._uniqueRatio(i,this.s.tableLength);if(!1===this.s.displayed&&((void 0===e.show&&null===e.threshold?m>this.c.threshold:m>e.threshold)||!0!==
e.show&&1>=i)){this.dom.container.addClass(this.classes.hidden);this.s.displayed=!1;return}this.s.displayed=!0}}else{if(0===g.arrayFilter.length)if(this._populatePane(),l&&l.searchPanes&&l.searchPanes.panes)if(-1!==m)g.binsOriginal=l.searchPanes.panes[m].bins,g.arrayOriginal=l.searchPanes.panes[m].arrayFilter;else{this.dom.container.addClass(this.classes.hidden);this.s.displayed=!1;return}else g.arrayOriginal=g.arrayFilter,g.binsOriginal=g.bins;i=Object.keys(g.binsOriginal).length;m=this._uniqueRatio(i,
c.rows()[0].length);if(!1===this.s.displayed&&((void 0===e.show&&null===e.threshold?m>this.c.threshold:m>e.threshold)||!0!==e.show&&1>=i)){this.dom.container.addClass(this.classes.hidden);this.s.displayed=!1;return}this.c.viewTotal&&0===g.arrayTotals.length?this._detailsPane():g.binsTotal=g.bins;this.dom.container.addClass(this.classes.show);this.s.displayed=!0}}else this.s.displayed=!0;this._displayPane();this.dom.dtP.on("stateLoadParams.dt",function(a,b,d){$.isEmptyObject(c.state.loaded())&&$.each(d,
function(a){delete d[a]})});i=$.fn.dataTable.ext.errMode;$.fn.dataTable.ext.errMode="none";m=n.Scroller;this.s.dtPane=$(this.dom.dtP).DataTable($.extend(!0,{columnDefs:[{className:"dtsp-nameColumn",data:"display",render:function(a,b,c){if(b==="sort")return c.sort;if(b==="type")return c.type;var f;d.s.filteringActive&&d.c.viewTotal?f=h.replace(/{total}/,c.total):f=k.replace(/{total}/,c.total);for(f=f.replace(/{shown}/,c.shown);f.indexOf("{total}")!==-1;)f=f.replace(/{total}/,c.total);for(;f.indexOf("{shown}")!==
-1;)f=f.replace(/{shown}/,c.shown);b="";f='<span class="'+d.classes.pill+'">'+f+"</span>";if(d.c.hideCount||e.hideCount)f="";return b=d.c.dataLength?a.length>d.c.dataLength?'<span class="'+d.classes.name+'">'+a.substr(0,d.c.dataLength)+"...</span>"+f:'<span class="'+d.classes.name+'">'+a+"</span>"+f:'<span class="'+d.classes.name+'">'+a+"</span>"+f},targets:0,type:void 0!==c.settings()[0].aoColumns[this.s.index]?c.settings()[0].aoColumns[this.s.index]._sManualType:null},{className:"dtsp-countColumn "+
this.classes.badgePill,data:"total",targets:1,visible:!1}],deferRender:!0,info:!1,paging:m?!0:!1,scrollY:"200px",scroller:m?!0:!1,select:!0,stateSave:c.settings()[0].oFeatures.bStateSave?!0:!1},this.c.dtOpts,void 0!==e?e.dtOpts:{},null!==this.customPaneSettings&&void 0!==this.customPaneSettings.dtOpts?this.customPaneSettings.dtOpts:{}));this.s.listenerActive||this._actListeners();$(this.dom.dtP).addClass(this.classes.table);$(this.dom.searchBox).attr("placeholder",void 0!==e.header?e.header:this.colExists?
c.settings()[0].aoColumns[this.s.index].sTitle:this.customPaneSettings.header||"Custom Pane");$.fn.dataTable.select.init(this.s.dtPane);$.fn.dataTable.ext.errMode=i;if(this.colExists){var f=(f=f.search())?f.substr(1,f.length-2).split("|"):[],p=0;g.arrayFilter.forEach(function(a){""===a.filter&&p++});i=0;for(f=g.arrayFilter.length;i<f;i++)if(this.s.dt.page.info().serverSide&&(!this.c.cascadePanes||this.c.cascadePanes&&0!==g.bins[g.arrayFilter[i].filter]||this.c.cascadePanes&&null!==b)){m=this._addRow(g.arrayFilter[i].display,
g.arrayFilter[i].filter,g.bins[g.arrayFilter[i].filter],this.c.viewTotal?String(g.binsTotal[g.arrayFilter[i].filter]):g.bins[g.arrayFilter[i].filter],g.arrayFilter[i].sort,g.arrayFilter[i].type);void 0!==e.preSelect&&-1!==e.preSelect.indexOf(g.arrayFilter[i].filter)&&m.select();for(var j=0,o=this.s.serverSelect;j<o.length;j++)o[j].filter===g.arrayFilter[i].filter&&(this.s.serverSelecting=!0,m.select(),this.s.serverSelecting=!1)}else!this.s.dt.page.info().serverSide&&g.arrayFilter[i]&&(void 0!==g.bins[g.arrayFilter[i].filter]||
!this.c.cascadePanes)?(m=this._addRow(g.arrayFilter[i].display,g.arrayFilter[i].filter,g.bins[g.arrayFilter[i].filter],g.binsTotal[g.arrayFilter[i].filter],g.arrayFilter[i].sort,g.arrayFilter[i].type),void 0!==e.preSelect&&-1!==e.preSelect.indexOf(g.arrayFilter[i].filter)&&m.select()):this.s.dt.page.info().serverSide||this._addRow(this.c.emptyMessage,p,p,this.c.emptyMessage,this.c.emptyMessage,this.c.emptyMessage)}(void 0!==e.options||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.options)&&
this._getComparisonRows();n.select.init(this.s.dtPane);this.s.dtPane.draw();this.s.dt.on("stateSaveParams.dtsp",function(a,b,c){if($.isEmptyObject(c))d.s.dtPane.state.clear();else{var a=[],e,f,k,i;void 0!==d.s.dtPane&&(a=d.s.dtPane.rows({selected:!0}).data().map(function(a){return a.filter.toString()}).toArray(),e=$(d.dom.searchBox).val(),f=d.s.dtPane.order(),k=g.binsOriginal,i=g.arrayOriginal);void 0===c.searchPanes&&(c.searchPanes={});void 0===c.searchPanes.panes&&(c.searchPanes.panes=[]);c.searchPanes.panes.push({arrayFilter:i,
bins:k,id:d.s.index,order:f,searchTerm:e,selected:a})}});if(l&&l.searchPanes&&l.searchPanes.panes){this.c.cascadePanes||this._reloadSelect(l);f=0;for(l=l.searchPanes.panes;f<l.length;f++)i=l[f],i.id===this.s.index&&($(this.dom.searchBox).val(i.searchTerm),this.s.dt.order(i.order))}$(this.dom.nameButton).on("click.dtsp",function(){var a=d.s.dtPane.order()[0][1];d.s.dtPane.order([0,"asc"===a?"desc":"asc"]).draw()});$(this.dom.countButton).on("click.dtsp",function(){var a=d.s.dtPane.order()[0][1];d.s.dtPane.order([1,
"asc"===a?"desc":"asc"]).draw()});$(this.dom.clear).on("click.dtsp",function(){d.dom.container.find("."+d.classes.search).each(function(){$(this).val("");$(this).trigger("input")});d.clearPane()});$(this.dom.searchButton).on("click.dtsp",function(){$(d.dom.searchBox).focus()});$(this.dom.searchBox).on("input.dtsp",function(){d.s.dtPane.search($(d.dom.searchBox).val()).draw();d.s.dt.state.save()});this.s.dt.state.save();return!0};h.prototype._actListeners=function(){var a=this,b;this.s.dtPane.on("deselect.dtsp",
function(){b=setTimeout(function(){a.s.dt.page.info().serverSide&&!a.s.updating?a.s.serverSelecting||(a.s.serverSelect=a.s.dtPane.rows({selected:!0}).data().toArray(),a.s.deselect=!0,a.s.dt.draw(!1)):(a.s.deselect=!0,0===a.s.dtPane.rows({selected:!0}).data().toArray().length&&$(a.dom.clear).addClass(a.classes.dull),a._makeSelection(),a.s.deselect=!1,a.s.dt.state.save())},50)});this.s.dtPane.on("select.dtsp",function(){a.s.dt.page.info().serverSide&&!a.s.updating?a.s.serverSelecting||(a.s.serverSelect=
a.s.dtPane.rows({selected:!0}).data().toArray(),a.s.selectPresent=!0,a.s.dt.draw(!1)):(clearTimeout(b),$(a.dom.clear).removeClass(a.classes.dull),a.s.selectPresent=!0,a.s.updating||a._makeSelection(),a.s.selectPresent=!1)});this.s.dtPane.on("user-select.dtsp",function(a,b,f,e,g){g.stopPropagation()});this.s.listenerActive=!0};h.prototype._detailsPane=function(){var a=this,b=this.s.dt;this.s.rowData.arrayTotals=[];this.s.rowData.binsTotal={};var d=this.s.dt.settings()[0];b.rows().every(function(b){a._populatePaneArray(b,
a.s.rowData.arrayTotals,d,a.s.rowData.binsTotal)})};h.prototype._displayPane=function(){var a=this.dom.container,b=this.s.colOpts,d=parseInt(this.c.layout.split("-")[1],10);$(this.dom.topRow).empty();$(this.dom.dtP).empty();$(this.dom.topRow).addClass(this.classes.topRow);3<d&&$(this.dom.container).addClass(this.classes.smallGap);$(this.dom.topRow).addClass(this.classes.subRowsContainer);$(this.dom.upper).appendTo(this.dom.topRow);$(this.dom.lower).appendTo(this.dom.topRow);$(this.dom.searchCont).appendTo(this.dom.upper);
$(this.dom.buttonGroup).appendTo(this.dom.lower);(!1===this.c.dtOpts.searching||void 0!==b.dtOpts&&!1===b.dtOpts.searching||!this.c.controls||!b.controls||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.dtOpts&&void 0!==this.customPaneSettings.dtOpts.searching&&!this.customPaneSettings.dtOpts.searching)&&$(this.dom.searchBox).attr("disabled","disabled").removeClass(this.classes.paneInputButton).addClass(this.classes.disabledButton);$(this.dom.searchBox).appendTo(this.dom.searchCont);
this._searchContSetup();this.c.clear&&(this.c.controls&&b.controls)&&$(this.dom.clear).appendTo(this.dom.buttonGroup);this.c.orderable&&(b.orderable&&this.c.controls&&b.controls)&&$(this.dom.nameButton).appendTo(this.dom.buttonGroup);!this.c.hideCount&&(!b.hideCount&&this.c.orderable&&b.orderable&&this.c.controls&&b.controls)&&$(this.dom.countButton).appendTo(this.dom.buttonGroup);$(this.dom.topRow).prependTo(this.dom.container);$(a).append(this.dom.dtP);$(a).show()};h.prototype._findUnique=function(a,
b){for(var d=[],c=0;c<b.length;c++){var f=b[c];-1===d.indexOf(f.filter)&&(a.push({display:f.display,filter:f.filter,sort:f.sort,type:f.type}),d.push(f.filter))}};h.prototype._getBonusOptions=function(){return $.extend(!0,{},h.defaults,{orthogonal:{threshold:null},threshold:null},void 0!==this.c?this.c:{})};h.prototype._getComparisonRows=function(){var a=this.s.colOpts,a=void 0!==a.options?a.options:null!==this.customPaneSettings&&void 0!==this.customPaneSettings.options?this.customPaneSettings.options:
void 0;if(void 0!==a){var b=this.s.dt.rows({search:"applied"}).data().toArray(),d=this.s.dt.rows({search:"applied"}),c=this.s.dt.rows().data().toArray(),f=this.s.dt.rows(),e=[];this.s.dtPane.clear();for(var g=0;g<a.length;g++){var k=a[g],h=""!==k.label?k.label:this.c.emptyMessage,l=h,j="function"===typeof k.value?k.value:[],i=0,n=h,p=0;if("function"===typeof k.value){for(var o=0;o<b.length;o++)k.value.call(this.s.dt,b[o],d[0][o])&&i++;for(o=0;o<c.length;o++)k.value.call(this.s.dt,c[o],f[0][o])&&p++;
"function"!==typeof j&&j.push(k.filter)}(!this.c.cascadePanes||this.c.cascadePanes&&0!==i)&&e.push(this._addRow(l,j,i,p,n,h))}return e}};h.prototype._getOptions=function(){return $.extend(!0,{},h.defaults,{orthogonal:{threshold:null},threshold:null},this.s.dt.settings()[0].aoColumns[this.s.index].searchPanes)};h.prototype._makeSelection=function(){this.updateTable();this.s.updating=!0;this.s.dt.draw();this.s.updating=!1};h.prototype._populatePane=function(){var a=this.s.dt;this.s.rowData.arrayFilter=
[];this.s.rowData.bins={};var b=this.s.dt.settings()[0];if(!this.s.dt.page.info().serverSide)for(var d=0,a=(this.c.cascadePanes||this.c.viewTotal)&&!this.s.clearing?a.rows({search:"applied"}).indexes():a.rows().indexes();d<a.length;d++)this._populatePaneArray(a[d],this.s.rowData.arrayFilter,b)};h.prototype._populatePaneArray=function(a,b,d,c){void 0===c&&(c=this.s.rowData.bins);var f=this.s.colOpts;if("string"===typeof f.orthogonal)d=d.oApi._fnGetCellData(d,a,this.s.index,f.orthogonal),this.s.rowData.filterMap.set(a,
d),this._addOption(d,d,d,d,b,c);else{var e=d.oApi._fnGetCellData(d,a,this.s.index,f.orthogonal.search);this.s.rowData.filterMap.set(a,e);c[e]?c[e]++:(c[e]=1,this._addOption(e,d.oApi._fnGetCellData(d,a,this.s.index,f.orthogonal.display),d.oApi._fnGetCellData(d,a,this.s.index,f.orthogonal.sort),d.oApi._fnGetCellData(d,a,this.s.index,f.orthogonal.type),b,c))}};h.prototype._reloadSelect=function(a){if(void 0!==a){for(var b,d=0;d<a.searchPanes.panes.length;d++)if(a.searchPanes.panes[d].id===this.s.index){b=
d;break}if(void 0!==b)for(var d=this.s.dtPane,c=d.rows({order:"index"}).data().map(function(a){return null!==a.filter?a.filter.toString():null}).toArray(),f=0,a=a.searchPanes.panes[b].selected;f<a.length;f++){b=a[f];var e=-1;null!==b&&(e=c.indexOf(b.toString()));-1<e&&(d.row(e).select(),this.s.dt.state.save())}}};h.prototype._search=function(a,b){for(var d=this.s.colOpts,c=this.s.dt,f=0,e=this.selections;f<e.length;f++){var g=e[f];if(Array.isArray(a)){if(-1!==a.indexOf(g.filter))return!0}else if("function"===
typeof g.filter)if(g.filter.call(c,c.row(b).data(),b)){if(this.s.redraw||this.updatePane(),"or"===d.combiner)return!0}else{if("and"===d.combiner)return!1}else if(a===g.filter)return!0}return"and"===d.combiner?!0:!1};h.prototype._searchContSetup=function(){this.c.controls&&this.s.colOpts.controls&&$(this.dom.searchButton).appendTo(this.dom.searchLabelCont);!1===this.c.dtOpts.searching||(!1===this.s.colOpts.dtOpts.searching||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.dtOpts&&void 0!==
this.customPaneSettings.dtOpts.searching&&!this.customPaneSettings.dtOpts.searching)||$(this.dom.searchLabelCont).appendTo(this.dom.searchCont)};h.prototype._searchExtras=function(){var a=this.s.updating;this.s.updating=!0;var b=this.s.dtPane.rows({selected:!0}).data().pluck("filter").toArray(),d=b.indexOf(this.c.emptyMessage),c=$(this.s.dtPane.table().container());-1<d&&(b[d]="");0<b.length?c.addClass(this.classes.selected):0===b.length&&c.removeClass(this.classes.selected);this.s.updating=a};h.prototype._uniqueRatio=
function(a,b){return 0<b?a/b:1};h.prototype._updateCommon=function(a){void 0===a&&(a=!1);if(void 0!==this.s.dtPane&&(!this.s.filteringActive||this.c.cascadePanes||!0===a)&&(!0!==this.c.cascadePanes||!0!==this.s.selectPresent)&&!this.s.lastSelect){var b=this.s.colOpts,d=this.s.dtPane.rows({selected:!0}).data().toArray(),a=$(this.s.dtPane.table().node()).parent()[0].scrollTop,c=this.s.rowData;this.s.dtPane.clear();if(this.colExists){0===c.arrayFilter.length?this._populatePane():this.c.cascadePanes&&
this.s.dt.rows().data().toArray().length===this.s.dt.rows({search:"applied"}).data().toArray().length?(c.arrayFilter=c.arrayOriginal,c.bins=c.binsOriginal):(this.c.viewTotal||this.c.cascadePanes)&&this._populatePane();this.c.viewTotal?this._detailsPane():c.binsTotal=c.bins;this.c.viewTotal&&!this.c.cascadePanes&&(c.arrayFilter=c.arrayTotals);for(var f=function(a){if(a&&(c.bins[a.filter]!==void 0&&c.bins[a.filter]!==0&&e.c.cascadePanes||!e.c.cascadePanes||e.s.clearing)){var b=e._addRow(a.display,a.filter,
!e.c.viewTotal?c.bins[a.filter]:c.bins[a.filter]!==void 0?c.bins[a.filter]:0,e.c.viewTotal?String(c.binsTotal[a.filter]):c.bins[a.filter],a.sort,a.type),f=d.findIndex(function(b){return b.filter===a.filter});if(f!==-1){b.select();d.splice(f,1)}}},e=this,g=0,k=c.arrayFilter;g<k.length;g++)f(k[g])}if(void 0!==b.searchPanes&&void 0!==b.searchPanes.options||void 0!==b.options||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.options){f=function(a){var b=d.findIndex(function(b){if(b.display===
a.data().display)return!0});-1!==b&&(a.select(),d.splice(b,1))};g=0;for(k=this._getComparisonRows();g<k.length;g++)b=k[g],f(b)}for(f=0;f<d.length;f++)b=d[f],b=this._addRow(b.display,b.filter,0,this.c.viewTotal?b.total:0,b.filter,b.filter),this.s.updating=!0,b.select(),this.s.updating=!1;this.s.dtPane.draw();this.s.dtPane.table().node().parentNode.scrollTop=a}};h.version="0.0.2";h.classes={buttonGroup:"dtsp-buttonGroup",buttonSub:"dtsp-buttonSub",clear:"dtsp-clear",clearAll:"dtsp-clearAll",clearButton:"clearButton",
container:"dtsp-searchPane",countButton:"dtsp-countButton",disabledButton:"dtsp-disabledButton",dull:"dtsp-dull",hidden:"dtsp-hidden",hide:"dtsp-hide",layout:"dtsp-",name:"dtsp-name",nameButton:"dtsp-nameButton",narrow:"dtsp-narrow",paneButton:"dtsp-paneButton",paneInputButton:"dtsp-paneInputButton",pill:"dtsp-pill",search:"dtsp-search",searchCont:"dtsp-searchCont",searchIcon:"dtsp-searchIcon",searchLabelCont:"dtsp-searchButtonCont",selected:"dtsp-selected",smallGap:"dtsp-smallGap",subRow1:"dtsp-subRow1",
subRow2:"dtsp-subRow2",subRowsContainer:"dtsp-subRowsContainer",title:"dtsp-title",topRow:"dtsp-topRow"};h.defaults={cascadePanes:!1,clear:!0,combiner:"or",controls:!0,container:function(a){return a.table().container()},dataLength:30,dtOpts:{},emptyMessage:"<i>No Data</i>",hideCount:!1,layout:"columns-3",orderable:!0,orthogonal:{display:"display",hideCount:!1,search:"filter",show:void 0,sort:"sort",threshold:0.6,type:"type"},preSelect:[],threshold:0.6,viewTotal:!1};q=h;var r=$.fn.dataTable,s,j=function(a,
b){var d=this;this.regenerating=!1;if(!r||!r.versionCheck||!r.versionCheck("1.10.0"))throw Error("SearchPane requires DataTables 1.10 or newer");if(!r.select)throw Error("SearchPane requires Select");var c=new r.Api(a);this.classes=$.extend(!0,{},j.classes);this.c=$.extend(!0,{},j.defaults,b);this.dom={clearAll:$('<button type="button">Clear All</button>').addClass(this.classes.clearAll),container:$("<div/>").addClass(this.classes.panes).text(c.i18n("searchPanes.loadMessage","Loading Search Panes...")),
emptyMessage:$("<div/>").addClass(this.classes.emptyMessage),options:$("<div/>").addClass(this.classes.container),panes:$("<div/>").addClass(this.classes.container),title:$("<div/>").addClass(this.classes.title),titleRow:$("<div/>").addClass(this.classes.titleRow),wrapper:$("<div/>")};this.s={colOpts:[],dt:c,filterPane:-1,panes:[],selectionList:[],serverData:{},updating:!1};c.on("xhr",function(a,b,c){c.searchPanes&&c.searchPanes.options&&(d.s.serverData=c.searchPanes.options,(d.c.viewTotal||d.c.cascadePanes)&&
d._serverTotals())});c.settings()[0]._searchPanes=this;this.dom.clearAll.text(c.i18n("searchPanes.clearMessage","Clear All"));this._getState();if(this.s.dt.settings()[0]._bInitComplete)this._paneDeclare(c,a,b);else c.on("preInit.dt",function(){d._paneDeclare(c,a,b)})};j.prototype.clearSelections=function(){this.dom.container.find(this.classes.search).each(function(){$(this).val("");$(this).trigger("input")});for(var a=[],b=0,d=this.s.panes;b<d.length;b++){var c=d[b];void 0!==c.s.dtPane&&a.push(c.clearPane())}this.s.dt.draw();
return a};j.prototype.getNode=function(){return this.dom.container};j.prototype.rebuild=function(a){void 0===a&&(a=!1);$(this.dom.emptyMessage).remove();var b=[];this.clearSelections();for(var d=0,c=this.s.panes;d<c.length;d++){var f=c[d];!1!==a&&f.s.index!==a||(f.clearData(),b.push(f.rebuildPane(this.s.dt.page.info().serverSide?this.s.serverData:void 0)))}this._updateFilterCount();this._attachPaneContainer();return 1===b.length?b[0]:b};j.prototype.redrawPanes=function(){var a=this.s.dt;if(!this.s.updating&&
!this.s.dt.page.info().serverSide){var b=!0,d=this.s.filterPane;if(a.rows({search:"applied"}).data().toArray().length===a.rows().data().toArray().length)b=!1;else if(this.c.viewTotal)for(var c=0,f=this.s.panes;c<f.length;c++){var e=f[c];if(void 0!==e.s.dtPane){var g=e.s.dtPane.rows({selected:!0}).data().toArray().length;0<g&&-1===d?d=e.s.index:0<g&&(d=null)}}f=void 0;c=[];if(this.regenerating){c=0;for(a=this.s.panes;c<a.length;c++)if(e=a[c],void 0!==e.s.dtPane){f=!0;e.s.filteringActive=!0;if(-1!==
d&&null!==d&&d===e.s.index||!1===b)f=!1,e.s.filteringActive=!1;e.updatePane(!f?f:b)}this._updateFilterCount()}else{for(var g=0,k=this.s.panes;g<k.length;g++)if(e=k[g],e.s.selectPresent){this.s.selectionList.push({index:e.s.index,rows:e.s.dtPane.rows({selected:!0}).data().toArray(),protect:!1});a.state.save();break}else if(e.s.deselect){var f=e.s.index,h=e.s.dtPane.rows({selected:!0}).data().toArray();0<h.length&&this.s.selectionList.push({index:e.s.index,rows:h,protect:!0})}if(0<this.s.selectionList.length){a=
this.s.selectionList[this.s.selectionList.length-1].index;g=0;for(k=this.s.panes;g<k.length;g++)e=k[g],e.s.lastSelect=e.s.index===a&&1===this.s.selectionList.length}for(e=0;e<this.s.selectionList.length;e++)if(this.s.selectionList[e].index!==f||!0===this.s.selectionList[e].protect){a=!1;for(g=e+1;g<this.s.selectionList.length;g++)this.s.selectionList[g].index===this.s.selectionList[e].index&&(a=!0);a||(c.push(this.s.selectionList[e]),this.s.selectionList[e].protect=!1)}a=0;for(g=this.s.panes;a<g.length;a++)if(e=
g[a],void 0!==e.s.dtPane){f=!0;e.s.filteringActive=!0;if(-1!==d&&null!==d&&d===e.s.index||!1===b)f=!1,e.s.filteringActive=!1;e.updatePane(!f?!1:b)}this._updateFilterCount();if(0<c.length&&c.length<this.s.selectionList.length){this._cascadeRegen(c);a=c[c.length-1].index;d=0;for(c=this.s.panes;d<c.length;d++)e=c[d],e.s.lastSelect=e.s.index===a&&1===this.s.selectionList.length}else if(0<c.length){e=0;for(c=this.s.panes;e<c.length;e++)if(a=c[e],void 0!==a.s.dtPane){f=!0;a.s.filteringActive=!0;if(-1!==
d&&null!==d&&d===a.s.index||!1===b)f=!1,a.s.filteringActive=!1;a.updatePane(!f?f:b)}}}b||(this.s.selectionList=[])}};j.prototype._attach=function(){$(this.dom.container).removeClass(this.classes.hide);$(this.dom.titleRow).removeClass(this.classes.hide);$(this.dom.titleRow).remove();$(this.dom.title).appendTo(this.dom.titleRow);this.c.clear&&$(this.dom.clearAll).appendTo(this.dom.titleRow);$(this.dom.titleRow).appendTo(this.dom.container);for(var a=0,b=this.s.panes;a<b.length;a++)$(b[a].dom.container).appendTo(this.dom.panes);
$(this.dom.panes).appendTo(this.dom.container);0===$("div."+this.classes.container).length&&$(this.dom.container).prependTo(this.s.dt);return this.dom.container};j.prototype._attachExtras=function(){$(this.dom.container).removeClass(this.classes.hide);$(this.dom.titleRow).removeClass(this.classes.hide);$(this.dom.titleRow).remove();$(this.dom.title).appendTo(this.dom.titleRow);this.c.clear&&$(this.dom.clearAll).appendTo(this.dom.titleRow);$(this.dom.titleRow).appendTo(this.dom.container);return this.dom.container};
j.prototype._attachMessage=function(){var a;try{a=this.s.dt.i18n("searchPanes.emptyPanes","No SearchPanes")}catch(b){a=null}if(null===a)$(this.dom.container).addClass(this.classes.hide),$(this.dom.titleRow).removeClass(this.classes.hide);else return $(this.dom.container).removeClass(this.classes.hide),$(this.dom.titleRow).addClass(this.classes.hide),$(this.dom.emptyMessage).text(a),this.dom.emptyMessage.appendTo(this.dom.container),this.dom.container};j.prototype._attachPaneContainer=function(){for(var a=
0,b=this.s.panes;a<b.length;a++)if(!0===b[a].s.displayed)return this._attach();return this._attachMessage()};j.prototype._cascadeRegen=function(a){this.regenerating=!0;var b=-1;1===a.length&&(b=a[0].index);for(var d=0,c=this.s.panes;d<c.length;d++){var f=c[d];f.setCascadeRegen(!0);f.setClear(!0);(void 0!==f.s.dtPane&&f.s.index===b||void 0!==f.s.dtPane)&&f.clearPane();f.setClear(!1)}this._makeCascadeSelections(a);this.s.selectionList=a;a=0;for(b=this.s.panes;a<b.length;a++)f=b[a],f.setCascadeRegen(!1);
this.regenerating=!1};j.prototype._checkMessage=function(){for(var a=0,b=this.s.panes;a<b.length;a++)if(!0===b[a].s.displayed)return;return this._attachMessage()};j.prototype._getState=function(){var a=this.s.dt.state.loaded();a&&(a.searchPanes&&void 0!==a.searchPanes.selectionList)&&(this.s.selectionList=a.searchPanes.selectionList)};j.prototype._makeCascadeSelections=function(a){for(var b=0;b<a.length;b++)for(var d=a[b],c=function(a){if(a.s.index===d.index&&void 0!==a.s.dtPane){0<a.s.dtPane.rows({selected:!0}).data().toArray().length&&
void 0!==a.s.dtPane&&(a.setClear(!0),a.clearPane(),a.setClear(!1));for(var b=function(b){a.s.dtPane.rows().every(function(c){a.s.dtPane.row(c).data().filter===b.filter&&a.s.dtPane.row(c).select()})},c=0,e=d.rows;c<e.length;c++)b(e[c]);f._updateFilterCount()}},f=this,e=0,g=this.s.panes;e<g.length;e++)c(g[e]);this.s.dt.state.save()};j.prototype._paneDeclare=function(a,b,d){var c=this;a.columns(0<this.c.columns.length?this.c.columns:void 0).eq(0).each(function(a){c.s.panes.push(new q(b,d,a,c.c.layout,
c.dom.panes))});for(var f=a.columns().eq(0).toArray().length,e=this.c.panes.length,g=0;g<e;g++)this.s.panes.push(new q(b,d,f+g,this.c.layout,this.dom.panes,this.c.panes[g]));this.s.dt.settings()[0]._bInitComplete?this._paneStartup(a):this.s.dt.settings()[0].aoInitComplete.push({fn:function(){c._paneStartup(a)}})};j.prototype._paneStartup=function(a){var b=this;500>=this.s.dt.page.info().recordsTotal?this._startup(a):setTimeout(function(){b._startup(a)},100)};j.prototype._serverTotals=function(){for(var a=
!1,b=!1,d=this.s.dt,c=0,f=this.s.panes;c<f.length;c++){var e=f[c];if(e.s.selectPresent){this.s.selectionList.push({index:e.s.index,rows:e.s.dtPane.rows({selected:!0}).data().toArray(),protect:!1});d.state.save();e.s.selectPresent=!1;a=!0;break}else e.s.deselect&&(b=e.s.dtPane.rows({selected:!0}).data().toArray(),0<b.length&&this.s.selectionList.push({index:e.s.index,rows:b,protect:!0}),b=a=!0)}if(a){e=[];for(d=0;d<this.s.selectionList.length;d++){c=!1;for(f=d+1;f<this.s.selectionList.length;f++)this.s.selectionList[f].index===
this.s.selectionList[d].index&&(c=!0);!c&&0<this.s.panes[this.s.selectionList[d].index].s.dtPane.rows({selected:!0}).data().toArray().length&&e.push(this.s.selectionList[d])}this.s.selectionList=e}else this.s.selectionList=[];d=-1;if(b&&1===this.s.selectionList.length){b=0;for(c=this.s.panes;b<c.length;b++)e=c[b],e.s.lastSelect=!1,e.s.deselect=!1,void 0!==e.s.dtPane&&0<e.s.dtPane.rows({selected:!0}).data().toArray().length&&(d=e.s.index)}else if(0<this.s.selectionList.length){b=this.s.selectionList[this.s.selectionList.length-
1].index;c=0;for(f=this.s.panes;c<f.length;c++)e=f[c],e.s.lastSelect=e.s.index===b,e.s.deselect=!1}else if(0===this.s.selectionList.length){b=0;for(c=this.s.panes;b<c.length;b++)e=c[b],e.s.lastSelect=!0===e.s.deselect,e.s.deselect=!1}b=0;for(c=this.s.panes;b<c.length;b++)e=c[b],e.s.lastSelect||e.rebuildPane(this.s.dt.page.info().serverSide?this.s.serverData:void 0,e.s.index===d?!0:null)};j.prototype._startup=function(a){var b=this;$(this.dom.container).text("");this._attachExtras();$(this.dom.container).append(this.dom.panes);
for(var d=0,c=this.s.panes;d<c.length;d++)c[d].rebuildPane(this.s.dt.page.info().serverSide?this.s.serverData:void 0);this._updateFilterCount();this._checkMessage();a.on("draw.dtsps",function(){b._updateFilterCount();(b.c.cascadePanes||b.c.viewTotal)&&!b.s.dt.page.info().serverSide&&b.redrawPanes();b.s.filterPane=-1});this.s.dt.on("stateSaveParams.dtsp",function(a,c,d){void 0===d.searchPanes&&(d.searchPanes={});d.searchPanes.selectionList=b.s.selectionList});0<this.s.selectionList.length&&this.c.cascadePanes&&
this._cascadeRegen(this.s.selectionList);a.columns(0<this.c.columns.length?this.c.columns:void 0).eq(0).each(function(a){if(void 0!==b.s.panes[a]&&void 0!==b.s.panes[a].s.dtPane&&void 0!==b.s.panes[a].s.colOpts.preSelect)for(var c=b.s.panes[a].s.dtPane.rows().data().toArray().length,d=0;d<c;d++)-1!==b.s.panes[a].s.colOpts.preSelect.indexOf(b.s.panes[a].s.dtPane.cell(d,0).data())&&(b.s.panes[a].s.dtPane.row(d).select(),b.s.panes[a].updateTable())});this._updateFilterCount();a.on("destroy.dtsps",function(){for(var c=
0,d=b.s.panes;c<d.length;c++)d[c].destroy();a.off(".dtsps");$(b.dom.clearAll).off(".dtsps");$(b.dom.container).remove();b.clearSelections()});if(this.c.clear)$(this.dom.clearAll).on("click.dtsps",function(){b.clearSelections()});if(this.s.dt.page.info().serverSide)a.on("preXhr.dt",function(a,c,d){void 0===d.searchPanes&&(d.searchPanes={});a=0;for(c=b.s.panes;a<c.length;a++){var h=c[a],j=b.s.dt.column(h.s.index).dataSrc();void 0===d.searchPanes[j]&&(d.searchPanes[j]=[]);if(void 0!==h.s.dtPane)for(var l=
0,h=h.s.dtPane.rows({selected:!0}).data().toArray();l<h.length;l++)d.searchPanes[j].push(h[l].display)}b.c.viewTotal&&b._prepViewTotal()});a.settings()[0]._searchPanes=this};j.prototype._prepViewTotal=function(){for(var a=this.s.filterPane,b=!1,d=0,c=this.s.panes;d<c.length;d++){var f=c[d];if(void 0!==f.s.dtPane){var e=f.s.dtPane.rows({selected:!0}).data().toArray().length;0<e&&-1===a?(a=f.s.index,b=!0):0<e&&(a=null)}}d=0;for(c=this.s.panes;d<c.length;d++)if(f=c[d],void 0!==f.s.dtPane&&(f.s.filteringActive=
!0,-1!==a&&null!==a&&a===f.s.index||!1===b))f.s.filteringActive=!1};j.prototype._updateFilterCount=function(){for(var a=0,b=0,d=this.s.panes;b<d.length;b++){var c=d[b];void 0!==c.s.dtPane&&(a+=c.getPaneCount())}a=this.s.dt.i18n("searchPanes.title","Filters Active - %d",a);$(this.dom.title).text(a)};j.version="0.0.2";j.classes={clear:"dtsp-clear",clearAll:"dtsp-clearAll",container:"dtsp-searchPanes",emptyMessage:"dtsp-emptyMessage",hide:"dtsp-hidden",panes:"dtsp-panesContainer",search:"dtsp-search",
title:"dtsp-title",titleRow:"dtsp-titleRow"};j.defaults={cascadePanes:!1,clear:!0,container:function(a){return a.table().container()},columns:[],layout:"columns-3",panes:[],viewTotal:!1};s=j;var t=function(a){function b(a){var a=new d.Api(a),b=a.init().searchPanes||d.defaults.searchPanes;return(new s(a,b)).getNode()}var d=a.fn.dataTable;a.fn.dataTable.SearchPanes=s;a.fn.DataTable.SearchPanes=s;a.fn.dataTable.SearchPane=q;a.fn.DataTable.SearchPane=q;d.Api.register("searchPanes.rebuild()",function(){return this.iterator("table",
function(){this.searchPanes&&this.searchPanes.rebuild()})});d.Api.register("column().paneOptions()",function(a){return this.iterator("column",function(b){b=this.aoColumns[b];b.searchPanes||(b.searchPanes={});b.searchPanes.values=a;this.searchPanes&&this.searchPanes.rebuild()})});var c=a.fn.dataTable.Api.register;c("searchPanes()",function(){return this});c("searchPanes.clearSelections()",function(){this.context[0]._searchPanes.clearSelections();return this});c("searchPanes.rebuildPane()",function(a){this.context[0]._searchPanes.rebuild(a);
return this});c("searchPanes.container()",function(){return this.context[0]._searchPanes.getNode()});a.fn.dataTable.ext.buttons.searchPanesClear={text:"Clear Panes",action:function(a,b){b.searchPanes.clearSelections()}};a.fn.dataTable.ext.buttons.searchPanes={text:"Search Panes",init:function(b,d,c){var h=new a.fn.dataTable.SearchPanes(b,{filterChanged:function(a){b.button(d).text(b.i18n("searchPanes.collapse",{"0":"SearchPanes",_:"SearchPanes (%d)"},a))}}),j=b.i18n("searchPanes.collapse","SearchPanes");
b.button(d).text(j);c._panes=h},action:function(a,b,d,c){a.stopPropagation();this.popover(c._panes.getNode(),{align:"dt-container"});c._panes.adjust()}};d.ext.feature.push({cFeature:"P",fnInit:b});d.ext.features&&d.ext.features.register("searchPanes",b)};"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(a){return t(a,window,document)}):"object"===typeof exports?module.exports=function(a,b){a||(a=window);if(!b||!b.fn.dataTable)b=require("datatables.net")(a,b).$;return t(b,
a,a.document)}:t(window.jQuery,window,document)})();
