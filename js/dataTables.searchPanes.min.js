/*!
 SearchPanes 1.0.1
 2019-2020 SpryMedia Ltd - datatables.net/license
*/
(function(){var c,m,p,g=function(a,b,i,d,f,h){var e=this;void 0===h&&(h=null);if(!m||!m.versionCheck||!m.versionCheck("1.10.0"))throw Error("SearchPane requires DataTables 1.10 or newer");if(!m.select)throw Error("SearchPane requires Select");a=new m.Api(a);this.classes=c.extend(!0,{},g.classes);this.c=c.extend(!0,{},g.defaults,b);this.customPaneSettings=h;this.s={cascadeRegen:!1,clearing:!1,colOpts:[],deselect:!1,displayed:!1,dt:a,dtPane:void 0,filteringActive:!1,index:i,indexes:[],lastSelect:!1,
listSet:!1,name:void 0,redraw:!1,rowData:{arrayFilter:[],arrayOriginal:[],arrayTotals:[],bins:{},binsOriginal:{},binsTotal:{},filterMap:new Map,totalOptions:0},searchFunction:void 0,selectPresent:!1,updating:!1};b=a.columns().eq(0).toArray().length;this.colExists=this.s.index<b;this.c.layout=d;b=parseInt(d.split("-")[1],10);this.dom={buttonGroup:c("<div/>").addClass(this.classes.buttonGroup),clear:c('<button type="button">&#215;</button>').addClass(this.classes.dull).addClass(this.classes.paneButton).addClass(this.classes.clearButton),
container:c("<div/>").addClass(this.classes.container).addClass(this.classes.layout+(10>b?d:d.split("-")[0]+"-9")),countButton:c('<button type="button"></button>').addClass(this.classes.paneButton).addClass(this.classes.countButton),dtP:c("<table><thead><tr><th>"+(this.colExists?c(a.column(this.colExists?this.s.index:0).header()).text():this.customPaneSettings.header||"Custom Pane")+"</th><th/></tr></thead></table>"),lower:c("<div/>").addClass(this.classes.subRow2).addClass(this.classes.narrowButton),
nameButton:c('<button type="button"></button>').addClass(this.classes.paneButton).addClass(this.classes.nameButton),searchBox:c("<input/>").addClass(this.classes.paneInputButton).addClass(this.classes.search),searchButton:c('<button type = "button" class="'+this.classes.searchIcon+'"></button>').addClass(this.classes.paneButton),searchCont:c("<div/>").addClass(this.classes.searchCont),searchLabelCont:c("<div/>").addClass(this.classes.searchLabelCont),topRow:c("<div/>").addClass(this.classes.topRow),
upper:c("<div/>").addClass(this.classes.subRow1).addClass(this.classes.narrowSearch)};this.s.displayed=!1;a=this.s.dt;this.selections=[];this.s.colOpts=this.colExists?this._getOptions():this._getBonusOptions();var q=this.s.colOpts,d=c('<button type="button">X</button>').addClass(this.classes.paneButton);c(d).text(a.i18n("searchPanes.clearPane","X"));this.dom.container.addClass(q.className);this.dom.container.addClass(null!==this.customPaneSettings&&void 0!==this.customPaneSettings.className?this.customPaneSettings.className:
"");this.s.name=void 0!==this.s.colOpts.name?this.s.colOpts.name:null!==this.customPaneSettings&&void 0!==this.customPaneSettings.name?this.customPaneSettings.name:this.colExists?c(a.column(this.s.index).header()).text():this.customPaneSettings.header||"Custom Pane";c(f).append(this.dom.container);var r=a.table(0).node();this.s.searchFunction=function(a,b,d){if(0===e.selections.length||a.nTable!==r)return!0;a="";e.colExists&&(a=b[e.s.index],"filter"!==q.orthogonal.filter&&(a=e.s.rowData.filterMap.get(d),
a instanceof c.fn.dataTable.Api&&(a=a.toArray())));return e._search(a,d)};c.fn.dataTable.ext.search.push(this.s.searchFunction);if(this.c.clear)c(d).on("click",function(){e.dom.container.find(e.classes.search).each(function(){c(this).val("");c(this).trigger("input")});e.clearPane()});a.on("draw.dtsp",function(){e._adjustTopRow()});c(window).on("resize.dtsp",m.util.throttle(function(){e._adjustTopRow()}));a.on("column-reorder.dtsp",function(a,b,d){e.s.index=d.mapping[e.s.index]});return this};g.prototype.clearData=
function(){this.s.rowData={arrayFilter:[],arrayOriginal:[],arrayTotals:[],bins:{},binsOriginal:{},binsTotal:{},filterMap:new Map,totalOptions:0}};g.prototype.clearPane=function(){this.s.dtPane.rows({selected:!0}).deselect();this.updateTable();return this};g.prototype.destroy=function(){c(this.s.dtPane).off(".dtsp");c(this.s.dt).off(".dtsp");c(this.dom.nameButton).off(".dtsp");c(this.dom.countButton).off(".dtsp");c(this.dom.clear).off(".dtsp");c(this.dom.searchButton).off(".dtsp");c(this.dom.container).remove();
for(var a=c.fn.dataTable.ext.search.indexOf(this.s.searchFunction);-1!==a;)c.fn.dataTable.ext.search.splice(a,1),a=c.fn.dataTable.ext.search.indexOf(this.s.searchFunction);void 0!==this.s.dtPane&&this.s.dtPane.destroy()};g.prototype.getPaneCount=function(){return void 0!==this.s.dtPane?this.s.dtPane.rows({selected:!0}).data().toArray().length:0};g.prototype.rebuildPane=function(a){void 0===a&&(a=!1);this.clearData();var b=[];void 0!==this.s.dtPane&&(b=this.s.dtPane.rows({selected:!0}).data().toArray(),
this.s.dtPane.clear().destroy(),this.s.dtPane=void 0);this.dom.container.removeClass(this.classes.hidden);this.s.displayed=!1;this._buildPane(b,a);return this};g.prototype.removePane=function(){this.s.displayed=!1;c(this.dom.container).hide()};g.prototype.setCascadeRegen=function(a){this.s.cascadeRegen=a};g.prototype.setClear=function(a){this.s.clearing=a};g.prototype.updatePane=function(a){void 0===a&&(a=!1);this.s.updating=!0;this._updateCommon(a);this.s.updating=!1};g.prototype.updateTable=function(){this.selections=
this.s.dtPane.rows({selected:!0}).data().toArray();this._searchExtras();(this.c.cascadePanes||this.c.viewTotal)&&this.updatePane()};g.prototype._addOption=function(a,b,i,d,f,h){if(Array.isArray(a)||a instanceof m.Api)if(a instanceof m.Api&&(a=a.toArray(),b=b.toArray()),a.length===b.length)for(var e=0;e<a.length;e++)h[a[e]]?h[a[e]]++:(h[a[e]]=1,f.push({display:b[e],filter:a[e],sort:i,type:d})),this.s.rowData.totalOptions++;else throw Error("display and filter not the same length");else"string"===typeof this.s.colOpts.orthogonal?
(h[a]?h[a]++:(h[a]=1,f.push({display:b,filter:a,sort:i,type:d})),this.s.rowData.totalOptions++):f.push({display:b,filter:a,sort:i,type:d})};g.prototype._addRow=function(a,b,i,d,f,h){for(var e,c=0,r=this.s.indexes;c<r.length;c++){var l=r[c];l.filter===b&&(e=l.index)}void 0===e&&(e=this.s.indexes.length,this.s.indexes.push({filter:b,index:e}));return this.s.dtPane.row.add({display:""!==a?a:this.c.emptyMessage,filter:b,index:e,shown:i,sort:""!==f?f:this.c.emptyMessage,total:d,type:h})};g.prototype._adjustTopRow=
function(){var a=this.dom.container.find("."+this.classes.subRowsContainer),b=this.dom.container.find(".dtsp-subRow1"),i=this.dom.container.find(".dtsp-subRow2"),d=this.dom.container.find("."+this.classes.topRow);(252>c(a[0]).width()||252>c(d[0]).width())&&0!==c(a[0]).width()?(c(a[0]).addClass(this.classes.narrow),c(b[0]).addClass(this.classes.narrowSub).removeClass(this.classes.narrowSearch),c(i[0]).addClass(this.classes.narrowSub).removeClass(this.classes.narrowButton)):(c(a[0]).removeClass(this.classes.narrow),
c(b[0]).removeClass(this.classes.narrowSub).addClass(this.classes.narrowSearch),c(i[0]).removeClass(this.classes.narrowSub).addClass(this.classes.narrowButton))};g.prototype._buildPane=function(a,b){var i=this;void 0===a&&(a=[]);void 0===b&&(b=!1);this.selections=[];var d=this.s.dt,f=d.column(this.colExists?this.s.index:0),h=this.s.colOpts,e=this.s.rowData,q=d.i18n("searchPanes.count","{total}"),r=d.i18n("searchPanes.countFiltered","{shown} ({total})"),l=d.state.loaded();this.s.listSet&&(l=d.state());
if(this.colExists){var j=-1;if(l&&l.searchPanes&&l.searchPanes.panes)for(var g=0;g<l.searchPanes.panes.length;g++)if(l.searchPanes.panes[g].id===this.s.index){j=g;break}if((!1===h.show||void 0!==h.show&&!0!==h.show)&&-1===j)return this.dom.container.addClass(this.classes.hidden),this.s.displayed=!1;if(!0===h.show||-1!==j)this.s.displayed=!0;if(0===e.arrayFilter.length)if(this._populatePane(b),l&&l.searchPanes&&l.searchPanes.panes)if(-1!==j)e.binsOriginal=l.searchPanes.panes[j].bins,e.arrayOriginal=
l.searchPanes.panes[j].arrayFilter;else{this.dom.container.addClass(this.classes.hidden);this.s.displayed=!1;return}else e.arrayOriginal=e.arrayFilter,e.binsOriginal=e.bins;g=Object.keys(e.binsOriginal).length;j=this._uniqueRatio(g,d.rows()[0].length);if(!1===this.s.displayed&&((void 0===h.show&&null===h.threshold?j>this.c.threshold:j>h.threshold)||!0!==h.show&&1>=g)){this.dom.container.addClass(this.classes.hidden);this.s.displayed=!1;return}this.c.viewTotal&&0===e.arrayTotals.length?this._detailsPane():
e.binsTotal=e.bins;this.dom.container.addClass(this.classes.show)}this.s.displayed=!0;this._displayPane();if(!this.s.listSet)this.dom.dtP.on("stateLoadParams.dt",function(a,b,e){c.isEmptyObject(d.state.loaded())&&c.each(e,function(a){delete e[a]})});g=c.fn.dataTable.ext.errMode;c.fn.dataTable.ext.errMode="none";j=m.Scroller;this.s.dtPane=c(this.dom.dtP).DataTable(c.extend(!0,{columnDefs:[{className:"dtsp-nameColumn",data:"display",render:function(a,b,e){if(b==="sort")return e.sort;if(b==="type")return e.type;
var d;i.s.filteringActive&&i.c.viewTotal?d=r.replace(/{total}/,e.total):d=q.replace(/{total}/,e.total);for(d=d.replace(/{shown}/,e.shown);d.indexOf("{total}")!==-1;)d=d.replace(/{total}/,e.total);for(;d.indexOf("{shown}")!==-1;)d=d.replace(/{shown}/,e.shown);b="";d='<span class="'+i.classes.pill+'">'+d+"</span>";if(i.c.hideCount||h.hideCount)d="";return b=i.c.dataLength?a.length>i.c.dataLength?'<span class="'+i.classes.name+'">'+a.substr(0,i.c.dataLength)+"...</span>"+d:'<span class="'+i.classes.name+
'">'+a+"</span>"+d:'<span class="'+i.classes.name+'">'+a+"</span>"+d},targets:0,type:void 0!==d.settings()[0].aoColumns[this.s.index]?d.settings()[0].aoColumns[this.s.index]._sManualType:null},{className:"dtsp-countColumn "+this.classes.badgePill,data:"total",targets:1,visible:!1}],deferRender:!0,dom:"t",info:!1,paging:j?!0:!1,scrollY:"200px",scroller:j?!0:!1,select:!0,stateSave:d.settings()[0].oFeatures.bStateSave?!0:!1},this.c.dtOpts,void 0!==h?h.dtOpts:{},null!==this.customPaneSettings&&void 0!==
this.customPaneSettings.dtOpts?this.customPaneSettings.dtOpts:{}));c(this.dom.dtP).addClass(this.classes.table);c(this.dom.searchBox).attr("placeholder",void 0!==h.header?h.header:this.colExists?d.settings()[0].aoColumns[this.s.index].sTitle:this.customPaneSettings.header||"Custom Pane");c.fn.dataTable.select.init(this.s.dtPane);c.fn.dataTable.ext.errMode=g;if(this.colExists){var f=(f=f.search())?f.substr(1,f.length-2).split("|"):[],k=0;e.arrayFilter.forEach(function(a){""===a.filter&&k++});g=0;for(j=
e.arrayFilter.length;g<j;g++)e.arrayFilter[g]&&(void 0!==e.bins[e.arrayFilter[g].filter]||!this.c.cascadePanes)?(f=this._addRow(e.arrayFilter[g].display,e.arrayFilter[g].filter,e.bins[e.arrayFilter[g].filter],e.binsTotal[e.arrayFilter[g].filter],e.arrayFilter[g].sort,e.arrayFilter[g].type),void 0!==h.preSelect&&-1!==h.preSelect.indexOf(e.arrayFilter[g].filter)&&f.select()):this._addRow(this.c.emptyMessage,k,k,this.c.emptyMessage,this.c.emptyMessage,this.c.emptyMessage)}(void 0!==h.options||null!==
this.customPaneSettings&&void 0!==this.customPaneSettings.options)&&this._getComparisonRows();m.select.init(this.s.dtPane);this.s.dtPane.draw();this.s.listSet||(this._setListeners(),this.s.listSet=!0);e=0;for(g=a;e<g.length;e++)if(j=g[e],void 0!==j)for(var o=0,n=this.s.dtPane.rows().indexes().toArray();o<n.length;o++)f=n[o],void 0!==this.s.dtPane.row(f).data()&&j.filter===this.s.dtPane.row(f).data().filter&&this.s.dtPane.row(f).select();if(l&&l.searchPanes&&l.searchPanes.panes){this.c.cascadePanes||
this._reloadSelect(l);e=0;for(l=l.searchPanes.panes;e<l.length;e++)f=l[e],f.id===this.s.index&&(c(this.dom.searchBox).val(f.searchTerm),this.s.dt.order(f.order))}this.s.dt.state.save();return!0};g.prototype._setListeners=function(){var a=this,b=this.s.rowData;this.s.dtPane.on("select.dtsp",function(){clearTimeout(i);c(a.dom.clear).removeClass(a.classes.dull);a.s.selectPresent=!0;a.s.updating||a._makeSelection();a.s.selectPresent=!1});this.s.dt.on("stateSaveParams.dtsp",function(d,i,h){if(c.isEmptyObject(h))a.s.dtPane.state.clear();
else{var d=[],e,q,g,j;void 0!==a.s.dtPane&&(d=a.s.dtPane.rows({selected:!0}).data().map(function(a){return a.filter.toString()}).toArray(),e=c(a.dom.searchBox).val(),q=a.s.dtPane.order(),g=b.binsOriginal,j=b.arrayOriginal);void 0===h.searchPanes&&(h.searchPanes={});void 0===h.searchPanes.panes&&(h.searchPanes.panes=[]);h.searchPanes.panes.push({arrayFilter:j,bins:g,id:a.s.index,order:q,searchTerm:e,selected:d})}});this.s.dtPane.on("user-select.dtsp",function(a,b,i,e,c){c.stopPropagation()});c(this.dom.nameButton).on("click.dtsp",
function(){var b=a.s.dtPane.order()[0][1];a.s.dtPane.order([0,"asc"===b?"desc":"asc"]).draw()});c(this.dom.countButton).on("click.dtsp",function(){var b=a.s.dtPane.order()[0][1];a.s.dtPane.order([1,"asc"===b?"desc":"asc"]).draw()});c(this.dom.clear).on("click.dtsp",function(){a.dom.container.find("."+a.classes.search).each(function(){c(this).val("");c(this).trigger("input")});a.clearPane()});c(this.dom.searchButton).on("click.dtsp",function(){c(a.dom.searchBox).focus()});c(this.dom.searchBox).on("input.dtsp",
function(){a.s.dtPane.search(c(a.dom.searchBox).val()).draw();a.s.dt.state.save()});var i;this.s.dtPane.on("deselect.dtsp",function(){i=setTimeout(function(){a.s.deselect=!0;0===a.s.dtPane.rows({selected:!0}).data().toArray().length&&c(a.dom.clear).addClass(a.classes.dull);a._makeSelection();a.s.deselect=!1;a.s.dt.state.save()},50)})};g.prototype._detailsPane=function(){var a=this,b=this.s.dt;this.s.rowData.arrayTotals=[];this.s.rowData.binsTotal={};var i=this.s.dt.settings()[0];b.rows().every(function(b){a._populatePaneArray(b,
a.s.rowData.arrayTotals,i,a.s.rowData.binsTotal)})};g.prototype._displayPane=function(){var a=this.dom.container,b=this.s.colOpts,i=parseInt(this.c.layout.split("-")[1],10);c(this.dom.topRow).empty();c(this.dom.dtP).empty();c(this.dom.topRow).addClass(this.classes.topRow);3<i&&c(this.dom.container).addClass(this.classes.smallGap);c(this.dom.topRow).addClass(this.classes.subRowsContainer);c(this.dom.upper).appendTo(this.dom.topRow);c(this.dom.lower).appendTo(this.dom.topRow);c(this.dom.searchCont).appendTo(this.dom.upper);
c(this.dom.buttonGroup).appendTo(this.dom.lower);(!1===this.c.dtOpts.searching||void 0!==b.dtOpts&&!1===b.dtOpts.searching||!this.c.controls||!b.controls||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.dtOpts&&void 0!==this.customPaneSettings.dtOpts.searching&&!this.customPaneSettings.dtOpts.searching)&&c(this.dom.searchBox).attr("disabled","disabled").removeClass(this.classes.paneInputButton).addClass(this.classes.disabledButton);c(this.dom.searchBox).appendTo(this.dom.searchCont);
this._searchContSetup();this.c.clear&&(this.c.controls&&b.controls)&&c(this.dom.clear).appendTo(this.dom.buttonGroup);this.c.orderable&&(b.orderable&&this.c.controls&&b.controls)&&c(this.dom.nameButton).appendTo(this.dom.buttonGroup);!this.c.hideCount&&(!b.hideCount&&this.c.orderable&&b.orderable&&this.c.controls&&b.controls)&&c(this.dom.countButton).appendTo(this.dom.buttonGroup);c(this.dom.topRow).prependTo(this.dom.container);c(a).append(this.dom.dtP);c(a).show()};g.prototype._getBonusOptions=
function(){return c.extend(!0,{},g.defaults,{orthogonal:{threshold:null},threshold:null},void 0!==this.c?this.c:{})};g.prototype._getComparisonRows=function(){var a=this.s.colOpts,a=void 0!==a.options?a.options:null!==this.customPaneSettings&&void 0!==this.customPaneSettings.options?this.customPaneSettings.options:void 0;if(void 0!==a){var b=this.s.dt.rows({search:"applied"}).data().toArray(),i=this.s.dt.rows({search:"applied"}),d=this.s.dt.rows().data().toArray(),f=this.s.dt.rows(),h=[];this.s.dtPane.clear();
for(var e=0;e<a.length;e++){var c=a[e],g=""!==c.label?c.label:this.c.emptyMessage,j=g,k="function"===typeof c.value?c.value:[],m=0,o=g,p=0;if("function"===typeof c.value){for(var n=0;n<b.length;n++)c.value.call(this.s.dt,b[n],i[0][n])&&m++;for(n=0;n<d.length;n++)c.value.call(this.s.dt,d[n],f[0][n])&&p++;"function"!==typeof k&&k.push(c.filter)}(!this.c.cascadePanes||this.c.cascadePanes&&0!==m)&&h.push(this._addRow(j,k,m,p,o,g))}return h}};g.prototype._getOptions=function(){return c.extend(!0,{},g.defaults,
{orthogonal:{threshold:null},threshold:null},this.s.dt.settings()[0].aoColumns[this.s.index].searchPanes)};g.prototype._makeSelection=function(){this.updateTable();this.s.updating=!0;this.s.dt.draw();this.s.updating=!1};g.prototype._populatePane=function(a){void 0===a&&(a=!1);var b=this.s.dt;this.s.rowData.arrayFilter=[];this.s.rowData.bins={};for(var i=this.s.dt.settings()[0],d=0,a=(this.c.cascadePanes||this.c.viewTotal)&&!this.s.clearing&&!a?b.rows({search:"applied"}).indexes():b.rows().indexes();d<
a.length;d++)this._populatePaneArray(a[d],this.s.rowData.arrayFilter,i)};g.prototype._populatePaneArray=function(a,b,i,d){void 0===d&&(d=this.s.rowData.bins);var f=this.s.colOpts;if("string"===typeof f.orthogonal)i=i.oApi._fnGetCellData(i,a,this.s.index,f.orthogonal),this.s.rowData.filterMap.set(a,i),this._addOption(i,i,i,i,b,d);else{var c=i.oApi._fnGetCellData(i,a,this.s.index,f.orthogonal.search);this.s.rowData.filterMap.set(a,c);d[c]?d[c]++:(d[c]=1,this._addOption(c,i.oApi._fnGetCellData(i,a,this.s.index,
f.orthogonal.display),i.oApi._fnGetCellData(i,a,this.s.index,f.orthogonal.sort),i.oApi._fnGetCellData(i,a,this.s.index,f.orthogonal.type),b,d));this.s.rowData.totalOptions++}};g.prototype._reloadSelect=function(a){if(void 0!==a){for(var b,i=0;i<a.searchPanes.panes.length;i++)if(a.searchPanes.panes[i].id===this.s.index){b=i;break}if(void 0!==b)for(var i=this.s.dtPane,d=i.rows({order:"index"}).data().map(function(a){return null!==a.filter?a.filter.toString():null}).toArray(),f=0,a=a.searchPanes.panes[b].selected;f<
a.length;f++){b=a[f];var c=-1;null!==b&&(c=d.indexOf(b.toString()));-1<c&&(i.row(c).select(),this.s.dt.state.save())}}};g.prototype._search=function(a,b){for(var i=this.s.colOpts,d=this.s.dt,c=0,h=this.selections;c<h.length;c++){var e=h[c];if(Array.isArray(a)){if(-1!==a.indexOf(e.filter))return!0}else if("function"===typeof e.filter)if(e.filter.call(d,d.row(b).data(),b)){if("or"===i.combiner)return!0}else{if("and"===i.combiner)return!1}else if(a===e.filter)return!0}return"and"===i.combiner?!0:!1};
g.prototype._searchContSetup=function(){this.c.controls&&this.s.colOpts.controls&&c(this.dom.searchButton).appendTo(this.dom.searchLabelCont);!1===this.c.dtOpts.searching||(!1===this.s.colOpts.dtOpts.searching||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.dtOpts&&void 0!==this.customPaneSettings.dtOpts.searching&&!this.customPaneSettings.dtOpts.searching)||c(this.dom.searchLabelCont).appendTo(this.dom.searchCont)};g.prototype._searchExtras=function(){var a=this.s.updating;this.s.updating=
!0;var b=this.s.dtPane.rows({selected:!0}).data().pluck("filter").toArray(),i=b.indexOf(this.c.emptyMessage),d=c(this.s.dtPane.table().container());-1<i&&(b[i]="");0<b.length?d.addClass(this.classes.selected):0===b.length&&d.removeClass(this.classes.selected);this.s.updating=a};g.prototype._uniqueRatio=function(a,b){return 0<b&&0<this.s.rowData.totalOptions?a/this.s.rowData.totalOptions:1};g.prototype._updateCommon=function(a){void 0===a&&(a=!1);if(void 0!==this.s.dtPane&&(!this.s.filteringActive||
this.c.cascadePanes||!0===a)&&(!0!==this.c.cascadePanes||!0!==this.s.selectPresent)&&!this.s.lastSelect){var b=this.s.colOpts,i=this.s.dtPane.rows({selected:!0}).data().toArray(),a=c(this.s.dtPane.table().node()).parent()[0].scrollTop,d=this.s.rowData;this.s.dtPane.clear();if(this.colExists){0===d.arrayFilter.length?this._populatePane():this.c.cascadePanes&&this.s.dt.rows().data().toArray().length===this.s.dt.rows({search:"applied"}).data().toArray().length?(d.arrayFilter=d.arrayOriginal,d.bins=d.binsOriginal):
(this.c.viewTotal||this.c.cascadePanes)&&this._populatePane();this.c.viewTotal?this._detailsPane():d.binsTotal=d.bins;this.c.viewTotal&&!this.c.cascadePanes&&(d.arrayFilter=d.arrayTotals);for(var f=function(a){if(a&&(d.bins[a.filter]!==void 0&&d.bins[a.filter]!==0&&h.c.cascadePanes||!h.c.cascadePanes||h.s.clearing)){var b=h._addRow(a.display,a.filter,!h.c.viewTotal?d.bins[a.filter]:d.bins[a.filter]!==void 0?d.bins[a.filter]:0,h.c.viewTotal?String(d.binsTotal[a.filter]):d.bins[a.filter],a.sort,a.type),
e=i.findIndex(function(b){return b.filter===a.filter});if(e!==-1){b.select();i.splice(e,1)}}},h=this,e=0,g=d.arrayFilter;e<g.length;e++)f(g[e])}if(void 0!==b.searchPanes&&void 0!==b.searchPanes.options||void 0!==b.options||null!==this.customPaneSettings&&void 0!==this.customPaneSettings.options){f=function(a){var b=i.findIndex(function(b){if(b.display===a.data().display)return!0});-1!==b&&(a.select(),i.splice(b,1))};e=0;for(g=this._getComparisonRows();e<g.length;e++)b=g[e],f(b)}for(f=0;f<i.length;f++)b=
i[f],b=this._addRow(b.display,b.filter,0,this.c.viewTotal?b.total:0,b.filter,b.filter),b.select();this.s.dtPane.draw();this.s.dtPane.table().node().parentNode.scrollTop=a}};g.version="1.0.1";g.classes={buttonGroup:"dtsp-buttonGroup",buttonSub:"dtsp-buttonSub",clear:"dtsp-clear",clearAll:"dtsp-clearAll",clearButton:"clearButton",container:"dtsp-searchPane",countButton:"dtsp-countButton",disabledButton:"dtsp-disabledButton",dull:"dtsp-dull",hidden:"dtsp-hidden",hide:"dtsp-hide",layout:"dtsp-",name:"dtsp-name",
nameButton:"dtsp-nameButton",narrow:"dtsp-narrow",paneButton:"dtsp-paneButton",paneInputButton:"dtsp-paneInputButton",pill:"dtsp-pill",search:"dtsp-search",searchCont:"dtsp-searchCont",searchIcon:"dtsp-searchIcon",searchLabelCont:"dtsp-searchButtonCont",selected:"dtsp-selected",smallGap:"dtsp-smallGap",subRow1:"dtsp-subRow1",subRow2:"dtsp-subRow2",subRowsContainer:"dtsp-subRowsContainer",title:"dtsp-title",topRow:"dtsp-topRow"};g.defaults={cascadePanes:!1,clear:!0,combiner:"or",controls:!0,container:function(a){return a.table().container()},
dataLength:30,dtOpts:{},emptyMessage:"<i>No Data</i>",hideCount:!1,layout:"columns-3",name:void 0,orderable:!0,orthogonal:{display:"display",hideCount:!1,search:"filter",show:void 0,sort:"sort",threshold:0.6,type:"type"},preSelect:[],threshold:0.6,viewTotal:!1};p=g;var j,o,s,k=function(a,b,i){var d=this;void 0===i&&(i=!1);this.regenerating=!1;if(!o||!o.versionCheck||!o.versionCheck("1.10.0"))throw Error("SearchPane requires DataTables 1.10 or newer");if(!o.select)throw Error("SearchPane requires Select");
var c=new o.Api(a);this.classes=j.extend(!0,{},k.classes);this.c=j.extend(!0,{},k.defaults,b);this.dom={clearAll:j('<button type="button">Clear All</button>').addClass(this.classes.clearAll),container:j("<div/>").addClass(this.classes.panes).text(c.i18n("searchPanes.loadMessage","Loading Search Panes...")),emptyMessage:j("<div/>").addClass(this.classes.emptyMessage),options:j("<div/>").addClass(this.classes.container),panes:j("<div/>").addClass(this.classes.container),title:j("<div/>").addClass(this.classes.title),
titleRow:j("<div/>").addClass(this.classes.titleRow),wrapper:j("<div/>")};this.s={colOpts:[],dt:c,filterPane:-1,panes:[],selectionList:[],updating:!1};if(void 0===c.settings()[0]._searchPanes)if(c.settings()[0]._searchPanes=this,this.dom.clearAll.text(c.i18n("searchPanes.clearMessage","Clear All")),this._getState(),this.s.dt.settings()[0]._bInitComplete||i)this._paneDeclare(c,a,b);else c.one("preInit.dt",function(){d._paneDeclare(c,a,b)})};k.prototype.clearSelections=function(){this.dom.container.find(this.classes.search).each(function(){j(this).val("");
j(this).trigger("input")});for(var a=[],b=0,c=this.s.panes;b<c.length;b++){var d=c[b];void 0!==d.s.dtPane&&a.push(d.clearPane())}this.s.dt.draw();return a};k.prototype.getNode=function(){return this.dom.container};k.prototype.rebuild=function(a){void 0===a&&(a=!1);j(this.dom.emptyMessage).remove();for(var b=[],c=0,d=this.s.panes;c<d.length;c++){var f=d[c];!1!==a&&f.s.index!==a||b.push(f.rebuildPane(void 0!==this.s.selectionList[this.s.selectionList.length-1]?f.s.index===this.s.selectionList[this.s.selectionList.length-
1].index:!1))}this.c.cascadePanes||this.c.viewTotal?this.redrawPanes(!0):this._updateSelection();this._updateFilterCount();this._attachPaneContainer();return 1===b.length?b[0]:b};k.prototype.redrawPanes=function(a){void 0===a&&(a=!1);var b=this.s.dt;if(!this.s.updating){var c=!0,d=this.s.filterPane;if(b.rows({search:"applied"}).data().toArray().length===b.rows().data().toArray().length)c=!1;else if(this.c.viewTotal)for(var f=0,h=this.s.panes;f<h.length;f++){var e=h[f];if(void 0!==e.s.dtPane){var g=
e.s.dtPane.rows({selected:!0}).data().toArray().length;0<g&&-1===d?d=e.s.index:0<g&&(d=null)}}h=void 0;f=[];if(this.regenerating){a=0;for(f=this.s.panes;a<f.length;a++)if(e=f[a],void 0!==e.s.dtPane){h=!0;e.s.filteringActive=!0;if(-1!==d&&null!==d&&d===e.s.index||!1===c)h=!1,e.s.filteringActive=!1;e.updatePane(!h?h:c)}this._updateFilterCount()}else{for(var g=0,j=this.s.panes;g<j.length;g++)if(e=j[g],e.s.selectPresent){this.s.selectionList.push({index:e.s.index,rows:e.s.dtPane.rows({selected:!0}).data().toArray(),
protect:!1});b.state.save();break}else if(e.s.deselect){var h=e.s.index,l=e.s.dtPane.rows({selected:!0}).data().toArray();0<l.length&&this.s.selectionList.push({index:e.s.index,rows:l,protect:!0})}if(0<this.s.selectionList.length){b=this.s.selectionList[this.s.selectionList.length-1].index;g=0;for(j=this.s.panes;g<j.length;g++)e=j[g],e.s.lastSelect=e.s.index===b}for(e=0;e<this.s.selectionList.length;e++)if(this.s.selectionList[e].index!==h||!0===this.s.selectionList[e].protect){b=!1;for(g=e+1;g<this.s.selectionList.length;g++)this.s.selectionList[g].index===
this.s.selectionList[e].index&&(b=!0);b||(f.push(this.s.selectionList[e]),this.s.selectionList[e].protect=!1)}b=0;for(g=this.s.panes;b<g.length;b++)if(e=g[b],void 0!==e.s.dtPane){h=!0;e.s.filteringActive=!0;if(-1!==d&&null!==d&&d===e.s.index||!1===c)h=!1,e.s.filteringActive=!1;e.updatePane(!h?!1:c)}this._updateFilterCount();if(0<f.length&&(f.length<this.s.selectionList.length||a)){this._cascadeRegen(f);b=f[f.length-1].index;d=0;for(a=this.s.panes;d<a.length;d++)e=a[d],e.s.lastSelect=e.s.index===b}else if(0<
f.length){e=0;for(a=this.s.panes;e<a.length;e++)if(f=a[e],void 0!==f.s.dtPane){h=!0;f.s.filteringActive=!0;if(-1!==d&&null!==d&&d===f.s.index||!1===c)h=!1,f.s.filteringActive=!1;f.updatePane(!h?h:c)}}}c||(this.s.selectionList=[])}};k.prototype._attach=function(){var a=this;j(this.dom.container).removeClass(this.classes.hide);j(this.dom.titleRow).removeClass(this.classes.hide);j(this.dom.titleRow).remove();j(this.dom.title).appendTo(this.dom.titleRow);this.c.clear&&(j(this.dom.clearAll).appendTo(this.dom.titleRow),
j(this.dom.clearAll).on("click.dtsps",function(){a.clearSelections()}));j(this.dom.titleRow).appendTo(this.dom.container);for(var b=0,c=this.s.panes;b<c.length;b++)j(c[b].dom.container).appendTo(this.dom.panes);j(this.dom.panes).appendTo(this.dom.container);0===j("div."+this.classes.container).length&&j(this.dom.container).prependTo(this.s.dt);return this.dom.container};k.prototype._attachExtras=function(){j(this.dom.container).removeClass(this.classes.hide);j(this.dom.titleRow).removeClass(this.classes.hide);
j(this.dom.titleRow).remove();j(this.dom.title).appendTo(this.dom.titleRow);this.c.clear&&j(this.dom.clearAll).appendTo(this.dom.titleRow);j(this.dom.titleRow).appendTo(this.dom.container);return this.dom.container};k.prototype._attachMessage=function(){var a;try{a=this.s.dt.i18n("searchPanes.emptyPanes","No SearchPanes")}catch(b){a=null}if(null===a)j(this.dom.container).addClass(this.classes.hide),j(this.dom.titleRow).removeClass(this.classes.hide);else return j(this.dom.container).removeClass(this.classes.hide),
j(this.dom.titleRow).addClass(this.classes.hide),j(this.dom.emptyMessage).text(a),this.dom.emptyMessage.appendTo(this.dom.container),this.dom.container};k.prototype._attachPaneContainer=function(){for(var a=0,b=this.s.panes;a<b.length;a++)if(!0===b[a].s.displayed)return this._attach();return this._attachMessage()};k.prototype._cascadeRegen=function(a){this.regenerating=!0;var b=-1;1===a.length&&(b=a[0].index);for(var c=0,d=this.s.panes;c<d.length;c++){var f=d[c];f.setCascadeRegen(!0);f.setClear(!0);
(void 0!==f.s.dtPane&&f.s.index===b||void 0!==f.s.dtPane)&&f.clearPane();f.setClear(!1)}this._makeCascadeSelections(a);this.s.selectionList=a;a=0;for(b=this.s.panes;a<b.length;a++)f=b[a],f.setCascadeRegen(!1);this.regenerating=!1};k.prototype._checkMessage=function(){for(var a=0,b=this.s.panes;a<b.length;a++)if(!0===b[a].s.displayed)return;return this._attachMessage()};k.prototype._getState=function(){var a=this.s.dt.state.loaded();a&&(a.searchPanes&&void 0!==a.searchPanes.selectionList)&&(this.s.selectionList=
a.searchPanes.selectionList)};k.prototype._makeCascadeSelections=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=function(a){if(a.s.index===c.index&&void 0!==a.s.dtPane){0<a.s.dtPane.rows({selected:!0}).data().toArray().length&&void 0!==a.s.dtPane&&(a.setClear(!0),a.clearPane(),a.setClear(!1));for(var b=function(b){a.s.dtPane.rows().every(function(e){a.s.dtPane.row(e).data()!==void 0&&(b!==void 0&&a.s.dtPane.row(e).data().filter===b.filter)&&a.s.dtPane.row(e).select()})},e=0,d=c.rows;e<d.length;e++)b(d[e]);
f._updateFilterCount()}},f=this,h=0,e=this.s.panes;h<e.length;h++)d(e[h]);this.s.dt.state.save()};k.prototype._paneDeclare=function(a,b,c){var d=this;a.columns(0<this.c.columns.length?this.c.columns:void 0).eq(0).each(function(a){d.s.panes.push(new p(b,c,a,d.c.layout,d.dom.panes))});for(var f=a.columns().eq(0).toArray().length,h=this.c.panes.length,e=0;e<h;e++)this.s.panes.push(new p(b,c,f+e,this.c.layout,this.dom.panes,this.c.panes[e]));if(0<this.c.order.length){f=this.c.order.map(function(a){return d._findPane(a)});
this.dom.panes.empty();this.s.panes=f;f=0;for(h=this.s.panes;f<h.length;f++)this.dom.panes.append(h[f].dom.container)}this.s.dt.settings()[0]._bInitComplete?this._paneStartup(a):this.s.dt.settings()[0].aoInitComplete.push({fn:function(){d._paneStartup(a)}})};k.prototype._findPane=function(a){for(var b=0,c=this.s.panes;b<c.length;b++){var d=c[b];if(a===d.s.name)return d}};k.prototype._paneStartup=function(a){var b=this;500>=this.s.dt.page.info().recordsTotal?this._startup(a):setTimeout(function(){b._startup(a)},
100)};k.prototype._startup=function(a){var b=this;j(this.dom.container).text("");this._attachExtras();j(this.dom.container).append(this.dom.panes);for(var c=0,d=this.s.panes;c<d.length;c++){var f=d[c];f.rebuildPane()}this._updateFilterCount();this._checkMessage();a.on("draw.dtsps",function(){b._updateFilterCount();b.c.cascadePanes||b.c.viewTotal?b.redrawPanes():b._updateSelection();b.s.filterPane=-1});this.s.dt.on("stateSaveParams.dtsp",function(a,c,d){void 0===d.searchPanes&&(d.searchPanes={});d.searchPanes.selectionList=
b.s.selectionList});this.s.dt.on("xhr",function(){var a=!1;if(!b.s.dt.page.info().serverSide)b.s.dt.one("draw",function(){if(!a){a=!0;for(var c=0,d=b.s.panes;c<d.length;c++){var f=d[c];f.clearData();f.rebuildPane(void 0!==b.s.selectionList[b.s.selectionList.length-1]?f.s.index===b.s.selectionList[b.s.selectionList.length-1].index:!1)}b.c.cascadePanes||b.c.viewTotal?b.redrawPanes():b._updateSelection();b._checkMessage()}})});if(void 0!==this.s.selectionList&&0<this.s.selectionList.length)for(var c=
this.s.selectionList[this.s.selectionList.length-1].index,d=0,h=this.s.panes;d<h.length;d++)f=h[d],f.s.lastSelect=f.s.index===c;0<this.s.selectionList.length&&this.c.cascadePanes&&this._cascadeRegen(this.s.selectionList);a.columns(0<this.c.columns.length?this.c.columns:void 0).eq(0).each(function(a){if(void 0!==b.s.panes[a]&&void 0!==b.s.panes[a].s.dtPane&&void 0!==b.s.panes[a].s.colOpts.preSelect)for(var c=b.s.panes[a].s.dtPane.rows().data().toArray().length,d=0;d<c;d++)-1!==b.s.panes[a].s.colOpts.preSelect.indexOf(b.s.panes[a].s.dtPane.cell(d,
0).data())&&(b.s.panes[a].s.dtPane.row(d).select(),b.s.panes[a].updateTable())});this._updateFilterCount();a.on("destroy.dtsps",function(){for(var e=0,c=b.s.panes;e<c.length;e++)c[e].destroy();a.off(".dtsps");j(b.dom.clearAll).off(".dtsps");j(b.dom.container).remove();b.clearSelections()});if(this.c.clear)j(this.dom.clearAll).on("click.dtsps",function(){b.clearSelections()});a.settings()[0]._searchPanes=this};k.prototype._updateFilterCount=function(){for(var a=0,b=0,c=this.s.panes;b<c.length;b++){var d=
c[b];void 0!==d.s.dtPane&&(a+=d.getPaneCount())}b=this.s.dt.i18n("searchPanes.title","Filters Active - %d",a);j(this.dom.title).text(b);void 0!==this.c.filterChanged&&"function"===typeof this.c.filterChanged&&this.c.filterChanged(a)};k.prototype._updateSelection=function(){this.s.selectionList=[];for(var a=0,b=this.s.panes;a<b.length;a++){var c=b[a];void 0!==c.s.dtPane&&this.s.selectionList.push({index:c.s.index,rows:c.s.dtPane.rows({selected:!0}).data().toArray(),protect:!1})}this.s.dt.state.save()};
k.version="1.0.1";k.classes={clear:"dtsp-clear",clearAll:"dtsp-clearAll",container:"dtsp-searchPanes",emptyMessage:"dtsp-emptyMessage",hide:"dtsp-hidden",panes:"dtsp-panesContainer",search:"dtsp-search",title:"dtsp-title",titleRow:"dtsp-titleRow"};k.defaults={cascadePanes:!1,clear:!0,container:function(a){return a.table().container()},columns:[],filterChanged:void 0,layout:"columns-3",order:[],panes:[],viewTotal:!1};s=k;var t=function(a,b,g){function d(a,b){void 0===b&&(b=!1);var c=new f.Api(a),d=
c.init().searchPanes||f.defaults.searchPanes;return(new s(c,d,b)).getNode()}c=a;m=a.fn.dataTable;j=a;var f=o=a.fn.dataTable;a.fn.dataTable.SearchPanes=s;a.fn.DataTable.SearchPanes=s;a.fn.dataTable.SearchPane=p;a.fn.DataTable.SearchPane=p;f.Api.register("searchPanes.rebuild()",function(){return this.iterator("table",function(){this.searchPanes&&this.searchPanes.rebuild()})});f.Api.register("column().paneOptions()",function(a){return this.iterator("column",function(b){b=this.aoColumns[b];b.searchPanes||
(b.searchPanes={});b.searchPanes.values=a;this.searchPanes&&this.searchPanes.rebuild()})});b=a.fn.dataTable.Api.register;b("searchPanes()",function(){return this});b("searchPanes.clearSelections()",function(){this.context[0]._searchPanes.clearSelections();return this});b("searchPanes.rebuildPane()",function(a,b){this.context[0]._searchPanes.rebuild(a,b);return this});b("searchPanes.container()",function(){return this.context[0]._searchPanes.getNode()});a.fn.dataTable.ext.buttons.searchPanesClear=
{text:"Clear Panes",action:function(a,b){b.searchPanes.clearSelections()}};a.fn.dataTable.ext.buttons.searchPanes={action:function(a,b,c,d){a.stopPropagation();this.popover(d._panes.getNode(),{align:"dt-container"})},config:{},init:function(b,c,d){var f=new a.fn.dataTable.SearchPanes(b,a.extend({filterChanged:function(a){b.button(c).text(b.i18n("searchPanes.collapse",{"0":"SearchPanes",_:"SearchPanes (%d)"},a))}},d.config)),g=b.i18n("searchPanes.collapse","SearchPanes",0);b.button(c).text(g);d._panes=
f},text:"Search Panes"};a(g).on("preInit.dt.dtsp",function(a,b){if("dt"===a.namespace&&(b.oInit.searchPanes||f.defaults.searchPanes))b._searchPanes||d(b,!0)});f.ext.feature.push({cFeature:"P",fnInit:d});f.ext.features&&f.ext.features.register("searchPanes",d)};"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(a){return t(a,window,document)}):"object"===typeof exports?module.exports=function(a,b){a||(a=window);if(!b||!b.fn.dataTable)b=require("datatables.net")(a,b).$;
return t(b,a,a.document)}:t(window.jQuery,window,document)})();
